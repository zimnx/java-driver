

<!DOCTYPE html>
<html class="no-js" lang="en">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title> Prepared statements | Scylla Docs
    </title>
    <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
    <link
      rel="icon"
      href="../../../_static/img/favicon.ico"
      type="image/x-icon"
    />
    <link
      rel="icon"
      href="../../../_static/img/favicon-32x32.png"
      sizes="32x32"
    />
    <link
      rel="icon"
      href="../../../_static/img/favicon-228x228.png"
      sizes="192x192"
    />
    <link
      rel="apple-touch-icon"
      href="../../../_static/img/favicon-228x228.png"
    />
    <meta
      name="msapplication-TileImage"
      href="../../../_static/img/favicon-228x228.png"
    />
    <link rel="canonical" href="https://docs.scylladb.com/" />
    <link rel="author" href="mailto:info@scylladb.com" />
  <!-- connect to domain of font files -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

  <!-- optionally increase loading priority -->
  <link
    rel="preload"
    as="style"
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap"
  />

  <!-- async CSS -->
  <link
    rel="stylesheet"
    media="print"
    onload="this.onload=null;this.removeAttribute('media');"
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap"
  />

  <!-- no-JS fallback -->
  <noscript>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap"
    />
  </noscript>
  <link
    rel="stylesheet"
    href="../../../_static/css/main.css"
    type="text/css"
  />
  <link
    rel="stylesheet"
    href="../../../_static/pygments.css"
    type="text/css"
  /> <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />

  <script
    type="text/javascript"
    id="documentation_options"
    data-url_root="../../../"
    src="../../../_static/documentation_options.js"
  ></script>
  <script
    type="text/javascript"
    src="../../../_static/js/runtime.bundle.js"
  ></script>
  <script
    type="text/javascript"
    src="../../../_static/js/main.bundle.js"
  ></script> <script src="../../../_static/underscore.js"></script> <script src="../../../_static/doctools.js"></script> <script src="../../../_static/language_data.js"></script> <script src="../../../_static/clipboard.min.js"></script> <script src="../../../_static/copybutton.js"></script>

    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-T8P2JP");
    </script>
    <!-- End Google Tag Manager -->
    <!-- Marketo -->
    <script type="text/javascript">
      (function () {
        var didInit = false;
        function initMunchkin() {
          if (didInit === false) {
            didInit = true;
            Munchkin.init("791-QBF-350");
          }
        }
        var s = document.createElement("script");
        s.type = "text/javascript";
        s.async = true;
        s.src = "//munchkin.marketo.net/munchkin.js";
        s.onreadystatechange = function () {
          if (this.readyState == "complete" || this.readyState == "loaded") {
            initMunchkin();
          }
        };
        s.onload = initMunchkin;
        document.getElementsByTagName("head")[0].appendChild(s);
      })();
    </script>
    <!-- End Marketo -->
    <!-- Expertrec -->
    <script>
      var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
      var ci_search = document.createElement("script");
      ci_search.type = "text/javascript";
      ci_search.async = true;
      ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(ci_search, s);
    </script>
    <!-- End Expertrec -->

    <!-- Font Awesome -->
    <script
      src="https://kit.fontawesome.com/b1870adf6a.js"
      crossorigin="anonymous"
    ></script>
    <!-- End Font Awesome -->
  </head>
  
  <body>
     <header class="header">
  <div class="header-logo">
    <a class="header-logo__img" href="https://scylladb.com/">
      <img
        src="../../../_static/img/logo-scylla-docs.svg"
        alt="Scylla Documentation Logo"
      />
    </a>
    <span class="header-logo__bar"></span>
    <a class="header-logo__text" href="https://docs.scylladb.com/">
      Documentation
    </a>
  </div>
  <div class="header-navigation">
    <ul
      class="dropdown menu scylla-dropdown scylla-dropdown--header"
      data-dropdown-menu
    >
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Server <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a href="https://docs.scylladb.com/"
              ><i class="scylla-icon scylla-icon--about-us"></i>Scylla Open
              Source</a
            >
          </li>
          <li>
            <a href="https://docs.scylladb.com/"
              ><i class="scylla-icon scylla-icon--enterprise"></i>Scylla
              Enterprise</a
            >
          </li>
          <li>
            <a
              href="https://scylla.docs.scylladb.com/master/alternator/alternator.html"
            >
              <i class="scylla-icon scylla-icon--overview"></i>Scylla
              Alternator</a
            >
          </li>
        </ul>
      </li>
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Cloud <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a href="https://cloud.scylladb.com/">
              <i class="scylla-icon scylla-icon--cloud"></i>Scylla Cloud</a
            >
          </li>
          <li>
            <a href="https://docs.scylladb.com/scylla-cloud/">
              <i class="scylla-icon scylla-icon--cloud-docs"></i>Scylla Cloud
              Docs</a
            >
          </li>
        </ul>
      </li>
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Tools <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a href="https://manager.docs.scylladb.com/">
              <i class="scylla-icon scylla-icon--manager"></i>Scylla Manager</a
            >
          </li>
          <li>
            <a href="https://monitoring.docs.scylladb.com/">
              <i class="scylla-icon scylla-icon--monitoring"></i>Scylla
              Monitoring Stack</a
            >
          </li>
          <li>
            <a href="https://operator.docs.scylladb.com/">
              <i class="scylla-icon scylla-icon--operator"></i>Scylla Operator
            </a>
          </li>
        </ul>
      </li>
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Drivers <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a
              href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/"
            >
              <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
            </a>
          </li>
          <li>
            <a
              href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/"
            >
              <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
            </a>
          </li>
        </ul>
      </li>
    </ul>
    <div class="header-button">
      <a href="https://www.scylladb.com/download/" class="button">Download</a>
    </div>
  </div>
  <div class="header-search-box">
    <div class="search-box">
      <ci-search></ci-search>
    </div>
  </div>
  <div class="side-nav-toggle" data-toggle="side-nav">
  <div class="side-nav-toggle__button">
    <img src="../../../_static/img/menu.svg" alt="Menu" />
  </div>
</div>
</header>
    <section class="layout ">
      <div class="content large-order-2">
         

        <div class="pre-content">
          <div class="pre-content__left"><div class="breadcrumbs">
  <span class="bread__item">
    <a
      href="https://java-driver.docs.scylladb.com"
      class="bread__highlight"
    >
      <i class="fas fa-home"></i> Scylla Java Driver</a
    ></span
  >
  
  <span class="bread__item"
    ><a href="../../index.html">Manual</a></span
  >
  
  <span class="bread__item"
    ><a href="../index.html">Statements</a></span
  >
  
  <span class="bread__item bread__item--last">Prepared statements</span>
</div></div>
          <div class="pre-content__right"><ul
  class="dropdown menu scylla-dropdown scylla-dropdown--contribute"
  data-dropdown-menu
>
  <li class="scylla-dropdown__item">
    <a class="scylla-dropdown__title" href="#">
      <div class="scylla-dropdown__title--body">
        <i class="icon fa fa-github" aria-hidden="true"></i>
        Contribute
      </div>
      <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
    </a>
    <ul class="menu scylla-dropdown__content">
      <li>
        <a
          href="https://github.com/scylladb/java-driver/issues/new?title=Issue in page Prepared statements&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://java-driver.docs.scylladb.com/scylla-3.10.2.x/manual/statements/prepared/index%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix"
          target="_blank"
          >Report a doc issue
          <i class="icon fa fa-external-link" aria-hidden="true"></i
        ></a>
      </li>
      
      <li>
             
        <a
          href="https://github.com/scylladb/java-driver/edit/scylla-3.10.2.x/docs/source/manual/statements/prepared/index.md"
          target="_blank"
          >Edit this page
          <i class="icon fa fa-external-link" aria-hidden="true"></i
        ></a>
      </li>
      
      <li>
        <a href="https://docs.scylladb.com/contribute/" target="_blank"
          >Learn how to contribute
          <i class="icon fa fa-external-link" aria-hidden="true"></i
        ></a>
      </li>
    </ul>
  </li>
</ul></div>
        </div>
         <div class="section" id="prepared-statements">
<h1>Prepared statements<a class="headerlink" href="#prepared-statements" title="Permalink to this headline">¶</a></h1>
<p>Use <a class="reference external" href="https://java-driver.docs.scylladb.com/stable/api/com/datastax/driver/core/PreparedStatement.html">PreparedStatement</a> for queries that are executed multiple times in your application:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">PreparedStatement</span> <span class="n">prepared</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span>
  <span class="s">&quot;insert into product (sku, description) values (?, ?)&quot;</span><span class="o">);</span>

<span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">prepared</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="s">&quot;234827&quot;</span><span class="o">,</span> <span class="s">&quot;Mouse&quot;</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">bound</span><span class="o">);</span>

<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">prepared</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="s">&quot;987274&quot;</span><span class="o">,</span> <span class="s">&quot;Keyboard&quot;</span><span class="o">));</span>
</pre></div>
</div>
<p>When you prepare the statement, Cassandra will parse the query string, cache the result and return a unique identifier
(the <code class="docutils literal notranslate"><span class="pre">PreparedStatement</span></code> object keeps an internal reference to that identifier):</p>
<div class="highlight-ditaa notranslate"><div class="highlight"><pre><span></span>client                   driver           Cassandra
--+------------------------+----------------+------
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>
  <span class="p">|</span> session.prepare<span class="o">(</span>query<span class="o">)</span> <span class="p">|</span>                <span class="p">|</span>
  <span class="p">|</span>-----------------------&gt;<span class="p">|</span>                <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span> PREPARE<span class="o">(</span>query<span class="o">)</span> <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>---------------&gt;<span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span> - compute id
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span> - parse query string
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span> - cache <span class="o">(</span>id, parsed<span class="o">)</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span> PREPARED<span class="o">(</span>id<span class="o">)</span>   <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>&lt;---------------<span class="p">|</span>
  <span class="p">|</span>  PreparedStatement<span class="o">(</span>id<span class="o">)</span> <span class="p">|</span>                <span class="p">|</span>
  <span class="p">|</span>&lt;-----------------------<span class="p">|</span>                <span class="p">|</span>
</pre></div>
</div>
<p>When you bind and execute a prepared statement, the driver will only send the identifier, which allows Cassandra to
skip the parsing phase:</p>
<div class="highlight-ditaa notranslate"><div class="highlight"><pre><span></span>client                            driver                Cassandra
--+---------------------------------+---------------------+------
  <span class="p">|</span>                                 <span class="p">|</span>                     <span class="p">|</span>
  <span class="p">|</span> session.execute<span class="o">(</span>BoundStatement<span class="o">)</span> <span class="p">|</span>                     <span class="p">|</span>
  <span class="p">|</span>--------------------------------&gt;<span class="p">|</span>                     <span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span> EXECUTE<span class="o">(</span>id, values<span class="o">)</span> <span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span>--------------------&gt;<span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span>                     <span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span>                     <span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span>                     <span class="p">|</span> - get cache<span class="o">(</span>id<span class="o">)</span>
  <span class="p">|</span>                                 <span class="p">|</span>                     <span class="p">|</span> - execute query
  <span class="p">|</span>                                 <span class="p">|</span>                     <span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span>          ROWS       <span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span>&lt;--------------------<span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span>                     <span class="p">|</span>
  <span class="p">|</span>&lt;--------------------------------<span class="p">|</span>                     <span class="p">|</span>
</pre></div>
</div>
<p>You should prepare only once, and cache the <code class="docutils literal notranslate"><span class="pre">PreparedStatement</span></code> in your application (it is thread-safe). If you call
<code class="docutils literal notranslate"><span class="pre">prepare</span></code> multiple times with the same query string, the driver will log a warning.</p>
<p>If you execute a query only once, a prepared statement is inefficient because it requires two roundtrips. Consider a
<a class="reference external" href="../simple/">simple statement</a> instead.</p>
<div class="section" id="parameters-and-binding">
<h2>Parameters and binding<a class="headerlink" href="#parameters-and-binding" title="Permalink to this headline">¶</a></h2>
<p>Parameters can be either anonymous or named (named parameters are only
available with <a class="reference external" href="../../native_protocol">native protocol</a> v2 or above):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ps1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="s">&quot;insert into product (sku, description) values (?, ?)&quot;</span><span class="o">);</span>
<span class="n">ps2</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="s">&quot;insert into product (sku, description) values (:s, :d)&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>To turn the statement into its executable form, you need to <em>bind</em> it to create a <a class="reference external" href="https://java-driver.docs.scylladb.com/stable/api/com/datastax/driver/core/BoundStatement.html">BoundStatement</a>. As shown previously,
there is a shorthand to provide the parameters in the same call:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">ps1</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="s">&quot;324378&quot;</span><span class="o">,</span> <span class="s">&quot;LCD screen&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>You can also bind first, then use setters, which is slightly more
explicit:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Positional setters:</span>
<span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">ps1</span><span class="o">.</span><span class="na">bind</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="s">&quot;324378&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">&quot;LCD screen&quot;</span><span class="o">);</span>

<span class="c1">// Named setters:</span>
<span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">ps2</span><span class="o">.</span><span class="na">bind</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;s&quot;</span><span class="o">,</span> <span class="s">&quot;324378&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;d&quot;</span><span class="o">,</span> <span class="s">&quot;LCD screen&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>You can use named setters even if the query uses anonymous parameters;
Cassandra will name the parameters after the column they apply to:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">ps1</span><span class="o">.</span><span class="na">bind</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;sku&quot;</span><span class="o">,</span> <span class="s">&quot;324378&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;description&quot;</span><span class="o">,</span> <span class="s">&quot;LCD screen&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>This can be ambiguous if the query uses the same column multiple times,
for example: <code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">*</span> <span class="pre">from</span> <span class="pre">sales</span> <span class="pre">where</span> <span class="pre">sku</span> <span class="pre">=</span> <span class="pre">?</span> <span class="pre">and</span> <span class="pre">date</span> <span class="pre">&gt;</span> <span class="pre">?</span> <span class="pre">and</span> <span class="pre">date</span> <span class="pre">&lt;</span> <span class="pre">?</span></code>. In these situations, use positional setters or named parameters.</p>
<p>For native protocol V3 or below, all variables must be bound.  With native
protocol V4 or above, variables can be left unset, in which case they
will be ignored server side (no tombstones will be generated).  If you’re
reusing a bound statement you can use the <code class="docutils literal notranslate"><span class="pre">unset</span></code> method to unset variables
that were previously set:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">ps1</span><span class="o">.</span><span class="na">bind</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;sku&quot;</span><span class="o">,</span> <span class="s">&quot;324378&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;description&quot;</span><span class="o">,</span> <span class="s">&quot;LCD screen&quot;</span><span class="o">);</span>

<span class="c1">// Using the unset method to unset previously set value.</span>
<span class="c1">// Positional setter:</span>
<span class="n">bound</span><span class="o">.</span><span class="na">unset</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

<span class="c1">// Named setter:</span>
<span class="n">bound</span><span class="o">.</span><span class="na">unset</span><span class="o">(</span><span class="s">&quot;description&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>A bound statement also has getters to retrieve the values. Note that
this has a small performance overhead since values are stored in their
serialized form.</p>
<p><code class="docutils literal notranslate"><span class="pre">BoundStatement</span></code> is <strong>not thread-safe</strong>. You can reuse an instance multiple times with different parameters, but only
from a single thread and only if you use synchronous calls:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">ps1</span><span class="o">.</span><span class="na">bind</span><span class="o">();</span>

<span class="c1">// This is safe:</span>
<span class="n">bound</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;sku&quot;</span><span class="o">,</span> <span class="s">&quot;324378&quot;</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">bound</span><span class="o">);</span>

<span class="n">bound</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;sku&quot;</span><span class="o">,</span> <span class="s">&quot;324379&quot;</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">bound</span><span class="o">);</span>

<span class="c1">// This is NOT SAFE. executeAsync runs concurrently with your code, so the first execution might actually read the</span>
<span class="c1">// values after the second setString call, and you would insert 324381 twice:</span>
<span class="n">bound</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;sku&quot;</span><span class="o">,</span> <span class="s">&quot;324380&quot;</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">executeAsync</span><span class="o">(</span><span class="n">bound</span><span class="o">);</span>

<span class="n">bound</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;sku&quot;</span><span class="o">,</span> <span class="s">&quot;324381&quot;</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">executeAsync</span><span class="o">(</span><span class="n">bound</span><span class="o">);</span>
</pre></div>
</div>
<p>Also, make sure you don’t accidentally reuse parameters from previous executions.</p>
</div>
<div class="section" id="preparing-on-multiple-nodes">
<h2>Preparing on multiple nodes<a class="headerlink" href="#preparing-on-multiple-nodes" title="Permalink to this headline">¶</a></h2>
<p>Cassandra does not replicate prepared statements across the cluster. It is the
driver’s responsibility to ensure that each node’s cache is up to
date. It uses a number of strategies to achieve this:</p>
<ol>
<li><p>When a statement is initially prepared, it is first sent to a single
node in the cluster (this avoids hitting all nodes in case
the query string is wrong). Once that node replies successfully, the
driver re-prepares on all remaining nodes:</p>
<div class="highlight-ditaa notranslate"><div class="highlight"><pre><span></span>client                   driver           node1          node2  node3
--+------------------------+----------------+--------------+------+---
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span> session.prepare<span class="o">(</span>query<span class="o">)</span> <span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>-----------------------&gt;<span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span> PREPARE<span class="o">(</span>query<span class="o">)</span> <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>---------------&gt;<span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span> PREPARED<span class="o">(</span>id<span class="o">)</span>   <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>&lt;---------------<span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>           PREPARE<span class="o">(</span>query<span class="o">)</span>      <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>------------------------------&gt;<span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>           PREPARE<span class="o">(</span>query<span class="o">)</span>      <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>-------------------------------------&gt;<span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>&lt;-----------------------<span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
</pre></div>
</div>
<p>The prepared statement identifier is deterministic (it’s a hash of the query string), so it is the same
for all nodes.</p>
</li>
<li><p>if a node crashes, it loses all of its prepared statements. So the
driver keeps a client-side cache; anytime a node is marked back up,
the driver re-prepares all statements on it;</p></li>
<li><p>finally, if the driver tries to execute a statement and finds out
that the coordinator doesn’t know about it, it will re-prepare the
statement on the fly (this is transparent for the client, but will cost
two extra roundtrips):</p>
<div class="highlight-ditaa notranslate"><div class="highlight"><pre><span></span>client                          driver                         node1
--+-------------------------------+------------------------------+--
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>session.execute<span class="o">(</span>boundStatement<span class="o">)</span><span class="p">|</span>                              <span class="p">|</span>
  +------------------------------&gt;<span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>     EXECUTE<span class="o">(</span>id, values<span class="o">)</span>      <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>-----------------------------&gt;<span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>         UNPREPARED           <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>&lt;-----------------------------<span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>       PREPARE<span class="o">(</span>query<span class="o">)</span>         <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>-----------------------------&gt;<span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>        PREPARED<span class="o">(</span>id<span class="o">)</span>          <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>&lt;-----------------------------<span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>     EXECUTE<span class="o">(</span>id, values<span class="o">)</span>      <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>-----------------------------&gt;<span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>             ROWS             <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>&lt;-----------------------------<span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>&lt;------------------------------<span class="p">|</span>                              <span class="p">|</span>
</pre></div>
</div>
</li>
</ol>
<p>You can customize these strategies through <code class="docutils literal notranslate"><span class="pre">QueryOptions</span></code>:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/stable/api/com/datastax/driver/core/QueryOptions.html#setPrepareOnAllHosts-boolean-">setPrepareOnAllHosts</a> controls whether statements are initially
re-prepared on other hosts (step 1 above);</p></li>
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/stable/api/com/datastax/driver/core/QueryOptions.html#setReprepareOnUp-boolean-">setReprepareOnUp</a> controls whether statements are re-prepared on a
node that comes back up (step 2 above).</p></li>
</ul>
<p>Changing the driver’s defaults should be done with care and only in
specific situations; read each method’s Javadoc for detailed
explanations.</p>
</div>
<div class="section" id="avoid-preparing-select-queries">
<h2>Avoid preparing ‘SELECT *’ queries<a class="headerlink" href="#avoid-preparing-select-queries" title="Permalink to this headline">¶</a></h2>
<p>Both the driver and Cassandra maintain a mapping of <code class="docutils literal notranslate"><span class="pre">PreparedStatement</span></code> queries to their
metadata.  When a change is made to a table, such as a column being added or dropped, there
is currently no mechanism for Cassandra to invalidate the existing metadata.  Because of this,
the driver is not able to properly react to these changes and will improperly read rows after
a schema change is made.</p>
<p>Therefore it is currently recommended to list all columns of interest in
your prepared statements (i.e. <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">c</span> <span class="pre">FROM</span> <span class="pre">table</span></code>), instead of
relying on <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span></code>.</p>
<p>This will be addressed in a future release of both Cassandra and the driver.  Follow
<a class="reference external" href="https://issues.apache.org/jira/browse/CASSANDRA-10786">CASSANDRA-10786</a> and <a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-1196">JAVA-1196</a> for more information.</p>
</div>
</div>
  <div class="content-navigation">
  <div class="navigation navigation--prev">
    <a class="navigation__link" href="../simple/index.html">
      <button class="navigation__button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
      </button>
      <div class="navigation__title">
        <span class="colored">PREVIOUS</span> <br />Simple statements
      </div>
    </a>
  </div>
  <div class="navigation navigation--next">
    <a class="navigation__link" href="../built/index.html">
      <div class="navigation__title">
        <span class="colored">NEXT</span> <br />Built statements
      </div>
      <button class="navigation__button">
        <i class="scylla-icon scylla-icon--chevron-right"></i>
      </button>
    </a>
  </div>
</div> 
      </div>
      <div
        class="sidebar-left  large-order-1"
      > <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
  <button class="collapsible-button">
    <i class="scylla-icon scylla-icon--chevron-left"></i>
  </button>
  <div class="side-nav-content">
    <div class="side-nav__search">
      <div class="search-box">
        <ci-search></ci-search>
      </div>
    </div>
    <div class="side-nav__versions">
       <ul
  class="dropdown menu scylla-dropdown scylla-dropdown--versions "
  data-dropdown-menu
>
  <li class="scylla-dropdown__item">
    <a class="scylla-dropdown__title" href="#">
       3.10.2.x 
      <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
    </a>
    <ul class="menu scylla-dropdown__content"> 
      <li>
        <a href="../../../../scylla-3.7.2.x/index.html"
          >3.7.2.x</a
        >
      </li>
       
      <li>
        <a href="index.html"
          >3.10.2.x</a
        >
      </li>
       
    </ul>
  </li>
</ul> 
    </div>
    <div class="side-nav__content">
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Scylla Java Driver for Scylla and Apache Cassandra®</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Documentation</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../index.html">Manual</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../address_resolution/index.html">Address resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../async/index.html">Asynchronous programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../auth/index.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../compression/index.html">Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../control_connection/index.html">Control connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../custom_codecs/index.html">Custom Codecs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../custom_payloads/index.html">Custom Payloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../idempotence/index.html">Query idempotence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../load_balancing/index.html">Load balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging/index.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../metadata/index.html">Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../metrics/index.html">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../native_protocol/index.html">Native protocol</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../object_mapper/index.html">Object Mapper</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../object_mapper/creating/index.html">Definition of mapped classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../object_mapper/custom_codecs/index.html">Using custom codecs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../object_mapper/using/index.html">Using the mapper</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../osgi/index.html">OSGi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../paging/index.html">Paging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pooling/index.html">Connection pooling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../query_timestamps/index.html">Query timestamps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reconnection/index.html">Reconnection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../retries/index.html">Retries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shaded_jar/index.html">Using the shaded JAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../socket_options/index.html">Socket options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../speculative_execution/index.html">Speculative query execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ssl/index.html">SSL</a></li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../index.html">Statements</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../simple/index.html">Simple statements</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Prepared statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../built/index.html">Built statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../batch/index.html">Batch statements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tuples/index.html">Using Tuples with the Java driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../udts/index.html">User-defined types</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../upgrade_guide/index.html">Upgrade guide</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../upgrade_guide/migrating_from_astyanax/index.html">Migrating from Astyanax</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../upgrade_guide/migrating_from_astyanax/configuration/index.html">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../upgrade_guide/migrating_from_astyanax/language_level_changes/index.html">Language change : from Thrift to CQL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../upgrade_guide/migrating_from_astyanax/queries_and_results/index.html">Queries and Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/index.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog/index.html">Changelog</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
      
      <div class="sidebar-right large-order-3">
         <div class="secondary-side-nav custom-scroll-bar">
  <div class="secondary-side-nav__content">
    <p class="topic-title">On this page</p>
    <ul>
<li><a class="reference internal" href="#">Prepared statements</a><ul>
<li><a class="reference internal" href="#parameters-and-binding">Parameters and binding</a></li>
<li><a class="reference internal" href="#preparing-on-multiple-nodes">Preparing on multiple nodes</a></li>
<li><a class="reference internal" href="#avoid-preparing-select-queries">Avoid preparing ‘SELECT *’ queries</a></li>
</ul>
</li>
</ul>

  </div>
</div> 
      </div>
    </section>

    <footer class="footer">
  <div class="footer-group">
    <div class="footer-top">
      <a class="footer-logo" href="https://www.scylladb.com"
        ><img
          src="../../../_static/img/logo-scylla-horizontal-RGB.svg"
          alt="Logo"
      /></a>
      <div class="footer-links">
        <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
        <a
          class="footer-links__link"
          href="https://www.scylladb.com/company/contact-us/"
          >Contact Us</a
        >
        <a class="footer-links__link" href="https://www.scylladb.com/company/"
          >About Us</a
        >
      </div>
      <div class="footer-actions">
        <a
          class="footer-actions__link"
          href="https://groups.google.com/g/scylladb-users"
          target="_blank"
          ><span
            data-tooltip
            tabindex="1"
            title="User mailing list"
            data-position="bottom"
          >
            <img
              src="../../../_static/img/icons/icon-mail-list.svg"
              alt="Mail List Icon"
            />
          </span>
        </a>
        <a
          class="footer-actions__link"
          href="http://slack.scylladb.com/"
          target="_blank"
          ><span
            data-tooltip
            tabindex="1"
            title="User Slack channel"
            data-position="bottom"
          >
            <img
              src="../../../_static/img/icons/icon-slack.svg"
              alt="Slack Icon"
          /></span>
        </a>
      </div>
    </div>

    <div class="footer-bottom">
      <div class="footer-bottom__copyright"> &#169; 2022, ScyllaDB. All rights reserved.
      </div>
      <div class="footer-bottom__last-updated">
        Last updated on 07 February 2022.
      </div>
      <div class="footer-bottom__version">
        Powered by
        <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a> &amp;
        <a href="https://sphinx-theme.scylladb.com/"
          >ScyllaDB Theme 1.0.6</a
        >
      </div>
    </div>
  </div>
</footer>

    <noscript>
      <iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe>
    </noscript>
  </body>
</html>