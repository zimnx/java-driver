

<!DOCTYPE html>
<html class="no-js" lang="en">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title> Upgrade guide | Scylla Docs
    </title>
    <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
    <link
      rel="icon"
      href="../_static/img/favicon.ico"
      type="image/x-icon"
    />
    <link
      rel="icon"
      href="../_static/img/favicon-32x32.png"
      sizes="32x32"
    />
    <link
      rel="icon"
      href="../_static/img/favicon-228x228.png"
      sizes="192x192"
    />
    <link
      rel="apple-touch-icon"
      href="../_static/img/favicon-228x228.png"
    />
    <meta
      name="msapplication-TileImage"
      href="../_static/img/favicon-228x228.png"
    />
    <link rel="canonical" href="https://docs.scylladb.com/" />
    <link rel="author" href="mailto:info@scylladb.com" />
  <!-- connect to domain of font files -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

  <!-- optionally increase loading priority -->
  <link
    rel="preload"
    as="style"
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap"
  />

  <!-- async CSS -->
  <link
    rel="stylesheet"
    media="print"
    onload="this.onload=null;this.removeAttribute('media');"
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap"
  />

  <!-- no-JS fallback -->
  <noscript>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap"
    />
  </noscript>
  <link
    rel="stylesheet"
    href="../_static/css/main.css"
    type="text/css"
  />
  <link
    rel="stylesheet"
    href="../_static/pygments.css"
    type="text/css"
  /> <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />

  <script
    type="text/javascript"
    id="documentation_options"
    data-url_root="../"
    src="../_static/documentation_options.js"
  ></script>
  <script
    type="text/javascript"
    src="../_static/js/runtime.bundle.js"
  ></script>
  <script
    type="text/javascript"
    src="../_static/js/main.bundle.js"
  ></script> <script src="../_static/underscore.js"></script> <script src="../_static/doctools.js"></script> <script src="../_static/language_data.js"></script> <script src="../_static/clipboard.min.js"></script> <script src="../_static/copybutton.js"></script>

    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-T8P2JP");
    </script>
    <!-- End Google Tag Manager -->
    <!-- Marketo -->
    <script type="text/javascript">
      (function () {
        var didInit = false;
        function initMunchkin() {
          if (didInit === false) {
            didInit = true;
            Munchkin.init("791-QBF-350");
          }
        }
        var s = document.createElement("script");
        s.type = "text/javascript";
        s.async = true;
        s.src = "//munchkin.marketo.net/munchkin.js";
        s.onreadystatechange = function () {
          if (this.readyState == "complete" || this.readyState == "loaded") {
            initMunchkin();
          }
        };
        s.onload = initMunchkin;
        document.getElementsByTagName("head")[0].appendChild(s);
      })();
    </script>
    <!-- End Marketo -->
    <!-- Expertrec -->
    <script>
      var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
      var ci_search = document.createElement("script");
      ci_search.type = "text/javascript";
      ci_search.async = true;
      ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(ci_search, s);
    </script>
    <!-- End Expertrec -->

    <!-- Font Awesome -->
    <script
      src="https://kit.fontawesome.com/b1870adf6a.js"
      crossorigin="anonymous"
    ></script>
    <!-- End Font Awesome -->
  </head>
  
  <body>
     <header class="header">
  <div class="header-logo">
    <a class="header-logo__img" href="https://scylladb.com/">
      <img
        src="../_static/img/logo-scylla-docs.svg"
        alt="Scylla Documentation Logo"
      />
    </a>
    <span class="header-logo__bar"></span>
    <a class="header-logo__text" href="https://docs.scylladb.com/">
      Documentation
    </a>
  </div>
  <div class="header-navigation">
    <ul
      class="dropdown menu scylla-dropdown scylla-dropdown--header"
      data-dropdown-menu
    >
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Server <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a href="https://docs.scylladb.com/"
              ><i class="scylla-icon scylla-icon--about-us"></i>Scylla Open
              Source</a
            >
          </li>
          <li>
            <a href="https://docs.scylladb.com/"
              ><i class="scylla-icon scylla-icon--enterprise"></i>Scylla
              Enterprise</a
            >
          </li>
          <li>
            <a
              href="https://scylla.docs.scylladb.com/master/alternator/alternator.html"
            >
              <i class="scylla-icon scylla-icon--overview"></i>Scylla
              Alternator</a
            >
          </li>
        </ul>
      </li>
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Cloud <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a href="https://cloud.scylladb.com/">
              <i class="scylla-icon scylla-icon--cloud"></i>Scylla Cloud</a
            >
          </li>
          <li>
            <a href="https://docs.scylladb.com/scylla-cloud/">
              <i class="scylla-icon scylla-icon--cloud-docs"></i>Scylla Cloud
              Docs</a
            >
          </li>
        </ul>
      </li>
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Tools <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a href="https://manager.docs.scylladb.com/">
              <i class="scylla-icon scylla-icon--manager"></i>Scylla Manager</a
            >
          </li>
          <li>
            <a href="https://monitoring.docs.scylladb.com/">
              <i class="scylla-icon scylla-icon--monitoring"></i>Scylla
              Monitoring Stack</a
            >
          </li>
          <li>
            <a href="https://operator.docs.scylladb.com/">
              <i class="scylla-icon scylla-icon--operator"></i>Scylla Operator
            </a>
          </li>
        </ul>
      </li>
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Drivers <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a
              href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/"
            >
              <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
            </a>
          </li>
          <li>
            <a
              href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/"
            >
              <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
            </a>
          </li>
        </ul>
      </li>
    </ul>
    <div class="header-button">
      <a href="https://www.scylladb.com/download/" class="button">Download</a>
    </div>
  </div>
  <div class="header-search-box">
    <div class="search-box">
      <ci-search></ci-search>
    </div>
  </div>
  <div class="side-nav-toggle" data-toggle="side-nav">
  <div class="side-nav-toggle__button">
    <img src="../_static/img/menu.svg" alt="Menu" />
  </div>
</div>
</header>
    <section class="layout ">
      <div class="content large-order-2">
         

        <div class="admonition caution">
          <p class="admonition-title">Caution</p>
          <p>
            You are not reading the latest stable version of this documentation.
            If you want up-to-date information, please have a look at
            <a href="../../stable/index.html">
               3.10.2.x</a
            >.
          </p>
        </div>
        

        <div class="pre-content">
          <div class="pre-content__left"><div class="breadcrumbs">
  <span class="bread__item">
    <a
      href="https://java-driver.docs.scylladb.com"
      class="bread__highlight"
    >
      <i class="fas fa-home"></i> Scylla Java Driver</a
    ></span
  >
  
  <span class="bread__item bread__item--last">Upgrade guide</span>
</div></div>
          <div class="pre-content__right"><ul
  class="dropdown menu scylla-dropdown scylla-dropdown--contribute"
  data-dropdown-menu
>
  <li class="scylla-dropdown__item">
    <a class="scylla-dropdown__title" href="#">
      <div class="scylla-dropdown__title--body">
        <i class="icon fa fa-github" aria-hidden="true"></i>
        Contribute
      </div>
      <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
    </a>
    <ul class="menu scylla-dropdown__content">
      <li>
        <a
          href="https://github.com/scylladb/java-driver/issues/new?title=Issue in page Upgrade guide&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://java-driver.docs.scylladb.com/scylla-3.7.2.x/upgrade_guide/index%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix"
          target="_blank"
          >Report a doc issue
          <i class="icon fa fa-external-link" aria-hidden="true"></i
        ></a>
      </li>
      
      <li>
             
        <a
          href="https://github.com/scylladb/java-driver/edit/scylla-3.7.2.x/docs/source/upgrade_guide/index.md"
          target="_blank"
          >Edit this page
          <i class="icon fa fa-external-link" aria-hidden="true"></i
        ></a>
      </li>
      
      <li>
        <a href="https://docs.scylladb.com/contribute/" target="_blank"
          >Learn how to contribute
          <i class="icon fa fa-external-link" aria-hidden="true"></i
        ></a>
      </li>
    </ul>
  </li>
</ul></div>
        </div>
         <div class="section" id="upgrade-guide">
<h1>Upgrade guide<a class="headerlink" href="#upgrade-guide" title="Permalink to this headline">¶</a></h1>
<p>The purpose of this guide is to detail changes made by successive
versions of the Java driver.</p>
<div class="section" id="id1">
<h2>3.6.0<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ConsistencyLevel.LOCAL_SERIAL.isDCLocal()</span></code> now returns true. In driver
code, <code class="docutils literal notranslate"><span class="pre">isDCLocal()</span></code> is only used when evaluating a Statement’s
ConsistencyLevel (which does not include Serial CLs), but as a matter of
correctness this was updated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ReadFailureException</span></code> and <code class="docutils literal notranslate"><span class="pre">WriteFailureException</span></code> are now surfaced to
<code class="docutils literal notranslate"><span class="pre">RetryPolicy.onRequestError</span></code>. Consider updating custom <code class="docutils literal notranslate"><span class="pre">RetryPolicy</span></code>
implementations to account for this. In the general case, we recommend
using <code class="docutils literal notranslate"><span class="pre">RetryDecision.rethrow()</span></code>, see <a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-1944">JAVA-1944</a>.</p></li>
</ol>
</div>
<div class="section" id="id2">
<h2>3.5.0<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p>The <code class="docutils literal notranslate"><span class="pre">DowngradingConsistencyRetryPolicy</span></code> is now deprecated, see <a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-1752">JAVA-1752</a>.
It will also be removed in the next major release of the driver (4.0.0),
see <a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-1376">JAVA-1376</a>.</p>
<p>The main motivation is the agreement that this policy’s behavior should be
the application’s concern, not the driver’s.</p>
<p>We recognize that there are use cases where downgrading is good –
for instance, a dashboard application would present the latest information
by reading at QUORUM, but it’s acceptable for it to display stale information
by reading at ONE sometimes.</p>
<p>But APIs provided by the driver should instead encourage idiomatic use of
a distributed system like Apache Cassandra, and a downgrading policy works
against this. It suggests that an anti-pattern such as “try to read at QUORUM,
but fall back to ONE if that fails” is a good idea in general use cases,
when in reality it provides no better consistency guarantees than working
directly at ONE, but with higher latencies.</p>
<p>We therefore urge users to carefully choose upfront the consistency level that
works best for their use cases, and should they decide that the downgrading
behavior of <code class="docutils literal notranslate"><span class="pre">DowngradingConsistencyRetryPolicy</span></code> remains a good fit for certain
use cases, they will now have to implement this logic themselves, either
at application level, or alternatively at driver level, by rolling out their
own downgrading retry policy.</p>
<p>To help users migrate existing applications that rely on
<code class="docutils literal notranslate"><span class="pre">DowngradingConsistencyRetryPolicy</span></code>, see this <a class="reference external" href="https://github.com/datastax/java-driver/blob/3.x/driver-examples/src/main/java/com/datastax/driver/examples/retry/DowngradingRetry.java">online example</a> that illustrates
how to implement a downgrading logic at application level.</p>
</li>
</ol>
<ol>
<li><p>The <code class="docutils literal notranslate"><span class="pre">TokenAwarePolicy</span></code> now has a new constructor that takes a <code class="docutils literal notranslate"><span class="pre">ReplicaOrdering</span></code>
argument, see <a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-1448">JAVA-1448</a>.</p>
<p>One of the advantages of this feature is the new <code class="docutils literal notranslate"><span class="pre">NEUTRAL</span></code>
ordering strategy, which honors its child policy’s ordering, i.e., replicas
are returned in the same relative order as in the child policy’s query plan.</p>
<p>For example, if the child policy returns the plan [A, B, C, D], and the replicas
for the query being routed are [D, A, B], then the token aware policy would return
the plan [A, B, D, C].</p>
<p>As a consequence, the constructor taking a boolean parameter <code class="docutils literal notranslate"><span class="pre">shuffleReplicas</span></code>
is now deprecated and will be removed in the next major release.</p>
</li>
</ol>
</div>
<div class="section" id="id3">
<h2>3.4.0<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">QueryBuilder</span></code> methods <code class="docutils literal notranslate"><span class="pre">in</span></code>, <code class="docutils literal notranslate"><span class="pre">lt</span></code>, <code class="docutils literal notranslate"><span class="pre">lte</span></code>, <code class="docutils literal notranslate"><span class="pre">eq</span></code>, <code class="docutils literal notranslate"><span class="pre">gt</span></code>, and <code class="docutils literal notranslate"><span class="pre">gte</span></code> now accept
<code class="docutils literal notranslate"><span class="pre">Iterable</span></code> as input rather than just <code class="docutils literal notranslate"><span class="pre">List</span></code>. This should have no impact unless
you were accessing these methods using reflection in which case you need to
account for these new parameter types.</p>
</div>
<div class="section" id="id4">
<h2>3.3.1<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>Speculative executions can now be scheduled without delay: if
<code class="docutils literal notranslate"><span class="pre">SpeculativeExecutionPlan.nextExecution()</span></code> returns 0, the next execution will be fired immediately.
This allows aggressive policies that hit multiple replicas right away, in order to get the fastest
response possible. Note that this may break existing policies that used 0 to mean “no execution”;
make sure you use a negative value instead.</p>
</div>
<div class="section" id="id5">
<h2>3.2.0<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">SSLOptions</span></code> interface is now deprecated in favor of
<code class="docutils literal notranslate"><span class="pre">RemoteEndpointAwareSSLOptions</span></code>.
Similarly, the two existing implementations of that interface,
<code class="docutils literal notranslate"><span class="pre">JdkSSLOptions</span></code> and <code class="docutils literal notranslate"><span class="pre">NettySSLOptions</span></code>,
are now deprecated in favor of <code class="docutils literal notranslate"><span class="pre">RemoteEndpointAwareJdkSSLOptions</span></code>
and <code class="docutils literal notranslate"><span class="pre">RemoteEndpointAwareNettySSLOptions</span></code> respectively (see
<a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-1364">JAVA-1364</a>).</p>
<p>In 3.1.0, the driver would log a warning the first time it would skip
a retry for a non-idempotent request; this warning has now been
removed as users should now have adjusted their applications accordingly.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">caseSensitive</span></code> field on <code class="docutils literal notranslate"><span class="pre">&#64;Column</span></code> and <code class="docutils literal notranslate"><span class="pre">&#64;Field</span></code> annotation now only
applies to the <code class="docutils literal notranslate"><span class="pre">name</span></code> field on the annotation and not the name of the
variable / method itself.  If you were previously depending on the
name of the field, you should add a <code class="docutils literal notranslate"><span class="pre">name</span></code> field to the annotation,
i.e.:  <code class="docutils literal notranslate"><span class="pre">&#64;Column(name=&quot;userName&quot;,</span> <span class="pre">caseSensitive=true)</span></code>.</p>
</div>
<div class="section" id="id6">
<h2>3.1.0<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>This version introduces an important change in the default retry behavior: statements that are not idempotent are not
always retried automatically anymore.</p>
<p>Prior to 2.1.10, idempotence was not considered for retries. This exposed applications to the risk of applying a
non-idempotent statement twice (counter increment, list append…), or to more subtle bugs with lightweight transactions
(see <a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-819">JAVA-819</a>).</p>
<p>In 2.1.10 / 3.0.x, we introduced <code class="docutils literal notranslate"><span class="pre">IdempotenceAwareRetryPolicy</span></code>, which considers the <code class="docutils literal notranslate"><span class="pre">Statement#isIdempotent()</span></code> in the
retry decision process. However, for consistency with previous versions, this policy was not enabled by default (in
particular because statements are non-idempotent by default, and we didn’t want applications to suddenly stop retrying
queries that were retried before).</p>
<p>In 3.1.0, the default is now to <strong>not retry</strong> after a write timeout or request error if the statement is not idempotent.
This is handled internally, the retry policy methods are not even invoked in those cases (and therefore
<code class="docutils literal notranslate"><span class="pre">IdempotenceAwareRetryPolicy</span></code> has been deprecated). See the manual section about <a class="reference external" href="../manual/retries/">retries</a> for more
information.</p>
<p>In practice, here’s what upgrading to 3.1.0 means for you:</p>
<ul class="simple">
<li><p>if you were already handling idempotence in your application, there won’t be any change, but you can stop wrapping
your retry policy with <code class="docutils literal notranslate"><span class="pre">IdempotenceAwareRetryPolicy</span></code>;</p></li>
<li><p>otherwise, you might want to review how your code positions the <code class="docutils literal notranslate"><span class="pre">setIdempotent</span></code> flag on statements. In most cases the
driver can’t compute in automatically (because it doesn’t parse query strings), so it takes a conservative approach
and sets it to <code class="docutils literal notranslate"><span class="pre">false</span></code> by default. If you know the query is idempotent, you should set it to <code class="docutils literal notranslate"><span class="pre">true</span></code> manually. See the
<a class="reference external" href="../manual/idempotence/">query idempotence</a> section of the manual.</p></li>
</ul>
<p>The driver logs a warning the first time it ignores a non-idempotent request; this warning will be removed in version
3.2.0.</p>
</div>
<div class="section" id="id7">
<h2>3.0.4<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>The connection pool is now fully non-blocking (<a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-893">JAVA-893</a>),
which greatly improves asynchronous programming:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Session.executeAsync</span></code> won’t ever block the user thread anymore;</p></li>
<li><p>you can now safely run async queries on a session connected to a keyspace.</p></li>
</ul>
<p>This new implementation brings a couple of changes:</p>
<ul class="simple">
<li><p>pool saturation is no longer handled by a timeout, but instead by a bounded queue. As a consequence,
<code class="docutils literal notranslate"><span class="pre">PoolingOptions.setPoolTimeoutMillis</span></code> has been deprecated, and replaced by <code class="docutils literal notranslate"><span class="pre">setMaxQueueSize</span></code>;</p></li>
<li><p>a saturated pool will now throw <code class="docutils literal notranslate"><span class="pre">BusyPoolException</span></code> instead of <code class="docutils literal notranslate"><span class="pre">TimeoutException</span></code> (note that this exception is not
rethrown directly to the client, but wrapped in <code class="docutils literal notranslate"><span class="pre">NoHostAvailableException.getErrors()</span></code>).</p></li>
</ul>
</div>
<div class="section" id="id8">
<h2>3.0.0<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>This version brings parity with Cassandra 2.2 and 3.0.</p>
<p>It is <strong>not binary compatible</strong> with the driver’s 2.1 branch.
The main changes were introduced by the custom codecs feature (see below).
We’ve also seized the opportunity to remove code that was deprecated in 2.1.</p>
<ol>
<li><p>The default consistency level in <code class="docutils literal notranslate"><span class="pre">QueryOptions</span></code> is now <code class="docutils literal notranslate"><span class="pre">LOCAL_ONE</span></code>.</p></li>
<li><p><a class="reference external" href="../manual/custom_codecs/">Custom codecs</a>
(<a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-721">JAVA-721</a>)
introduce several breaking changes and also modify a few runtime behaviors.</p>
<p>Here is a detailed list of breaking API changes:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TypeCodec</span></code> was package-private before and is now public.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DataType</span></code> has no more references to <code class="docutils literal notranslate"><span class="pre">TypeCodec</span></code>, so methods that dealt with serialization and deserialization of
data types have been removed:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ByteBuffer</span> <span class="pre">serialize(Object</span> <span class="pre">value,</span> <span class="pre">ProtocolVersion</span> <span class="pre">protocolVersion)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ByteBuffer</span> <span class="pre">serializeValue(Object</span> <span class="pre">value,</span> <span class="pre">ProtocolVersion</span> <span class="pre">protocolVersion)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Object</span> <span class="pre">deserialize(ByteBuffer</span> <span class="pre">bytes,</span> <span class="pre">ProtocolVersion</span> <span class="pre">protocolVersion)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Object</span> <span class="pre">deserialize(ByteBuffer</span> <span class="pre">bytes,</span> <span class="pre">int</span> <span class="pre">protocolVersion)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Object</span> <span class="pre">parse(String</span> <span class="pre">value)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">String</span> <span class="pre">format(Object</span> <span class="pre">value)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Class&lt;?&gt;</span> <span class="pre">asJavaClass()</span></code></p></li>
</ul>
<p>These methods must now be invoked on <code class="docutils literal notranslate"><span class="pre">TypeCodec</span></code> directly. To resolve the <code class="docutils literal notranslate"><span class="pre">TypeCodec</span></code> instance for a particular
data type, use <code class="docutils literal notranslate"><span class="pre">CodecRegistry#codecFor</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GettableByIndexData</span></code> (affects <code class="docutils literal notranslate"><span class="pre">Row</span></code>, <code class="docutils literal notranslate"><span class="pre">BoundStatement</span></code>, <code class="docutils literal notranslate"><span class="pre">TupleValue</span></code> and <code class="docutils literal notranslate"><span class="pre">UDTValue</span></code>). The following public methods were added:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;T&gt;</span> <span class="pre">T</span> <span class="pre">get(int</span> <span class="pre">i,</span> <span class="pre">Class&lt;T&gt;</span> <span class="pre">targetClass)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;T&gt;</span> <span class="pre">T</span> <span class="pre">get(int</span> <span class="pre">i,</span> <span class="pre">TypeToken&lt;T&gt;</span> <span class="pre">targetType)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;T&gt;</span> <span class="pre">T</span> <span class="pre">get(int</span> <span class="pre">i,</span> <span class="pre">TypeCodec&lt;T&gt;</span> <span class="pre">codec)</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GettableByNameData</span></code> (affects <code class="docutils literal notranslate"><span class="pre">Row</span></code>, <code class="docutils literal notranslate"><span class="pre">BoundStatement</span></code> and <code class="docutils literal notranslate"><span class="pre">UDTValue</span></code>). The following public methods were added:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;T&gt;</span> <span class="pre">T</span> <span class="pre">get(String</span> <span class="pre">name,</span> <span class="pre">Class&lt;T&gt;</span> <span class="pre">targetClass)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;T&gt;</span> <span class="pre">T</span> <span class="pre">get(String</span> <span class="pre">name,</span> <span class="pre">TypeToken&lt;T&gt;</span> <span class="pre">targetType)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;T&gt;</span> <span class="pre">T</span> <span class="pre">get(String</span> <span class="pre">name,</span> <span class="pre">TypeCodec&lt;T&gt;</span> <span class="pre">codec)</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SettableByIndexData</span></code> (affects <code class="docutils literal notranslate"><span class="pre">Row</span></code>, <code class="docutils literal notranslate"><span class="pre">BoundStatement</span></code>, <code class="docutils literal notranslate"><span class="pre">TupleValue</span></code> and <code class="docutils literal notranslate"><span class="pre">UDTValue</span></code>). The following public methods were added:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;V&gt;</span> <span class="pre">T</span> <span class="pre">set(int</span> <span class="pre">i,</span> <span class="pre">V</span> <span class="pre">v,</span> <span class="pre">Class&lt;V&gt;</span> <span class="pre">targetClass)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;V&gt;</span> <span class="pre">T</span> <span class="pre">set(int</span> <span class="pre">i,</span> <span class="pre">V</span> <span class="pre">v,</span> <span class="pre">TypeToken&lt;V&gt;</span> <span class="pre">targetType)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;V&gt;</span> <span class="pre">T</span> <span class="pre">set(int</span> <span class="pre">i,</span> <span class="pre">V</span> <span class="pre">v,</span> <span class="pre">TypeCodec&lt;V&gt;</span> <span class="pre">codec)</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SettableByNameData</span></code> (affects <code class="docutils literal notranslate"><span class="pre">Row</span></code>, <code class="docutils literal notranslate"><span class="pre">BoundStatement</span></code> and <code class="docutils literal notranslate"><span class="pre">UDTValue</span></code>). The following public methods were added:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;V&gt;</span> <span class="pre">T</span> <span class="pre">set(String</span> <span class="pre">name,</span> <span class="pre">V</span> <span class="pre">v,</span> <span class="pre">Class&lt;V&gt;</span> <span class="pre">targetClass)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;V&gt;</span> <span class="pre">T</span> <span class="pre">set(String</span> <span class="pre">name,</span> <span class="pre">V</span> <span class="pre">v,</span> <span class="pre">TypeToken&lt;V&gt;</span> <span class="pre">targetType)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;V&gt;</span> <span class="pre">T</span> <span class="pre">set(String</span> <span class="pre">name,</span> <span class="pre">V</span> <span class="pre">v,</span> <span class="pre">TypeCodec&lt;V&gt;</span> <span class="pre">codec)</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Statement</span></code>. The following public methods were modified:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">getRoutingKey(ProtocolVersion,</span> <span class="pre">CodecRegistry)</span></code>: both parameters added.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">RegularStatement</span></code>. The following public methods were modified:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">getValues(ProtocolVersion,</span> <span class="pre">CodecRegistry)</span></code>: second parameter added.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getQueryString(CodecRegistry)</span></code> and <code class="docutils literal notranslate"><span class="pre">hasValues(CodecRegistry)</span></code>: parameter added. No-arg versions are still present
and use the default codec registry; refer to the Javadocs for guidance on which version to use.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">PreparedStatement</span></code>. The following public method was added:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CodecRegistry</span> <span class="pre">getCodecRegistry()</span></code>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">TupleType</span></code>. The following public method was deleted:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TupleType</span> <span class="pre">of(DataType...</span> <span class="pre">types)</span></code>; users should now use <code class="docutils literal notranslate"><span class="pre">Metadata.newTupleType(DataType...)</span></code>.</p></li>
</ul>
</li>
</ul>
<p>The driver runtime behavior changes in the following situations:</p>
* By default, the driver now returns _mutable_, _non thread-safe_ instances for CQL collection types;
  This affects methods `getList`, `getSet`, `getMap`, `getObject` and `get` for all instances of
  `GettableByIndexData` and `GettableByNameData` (`Row`, `BoundStatement`, `TupleValue` and `UDTValue`)
* `RuntimeException`s thrown during serialization or deserialization might not be
  the same ones as before, due to the newly-introduced `CodecNotFoundException`
  and to the dynamic nature of codec search introduced by JAVA-721.
* `TypeCodec.format(Object)` now returns the CQL keyword `"NULL"` instead of a `null` reference
  for `null` inputs.</li>
<li><p>The driver now depends on Guava 16.0.1 (instead of 14.0.1).
This update has been mainly motivated by Guava’s <a class="reference external" href="https://github.com/google/guava/issues/1635">Issue #1635</a>,
which affects <code class="docutils literal notranslate"><span class="pre">TypeToken</span></code>, and hence all <code class="docutils literal notranslate"><span class="pre">TypeCodec</span></code> implementations handling parameterized types.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UDTMapper</span></code> (the type previously used to convert <code class="docutils literal notranslate"><span class="pre">&#64;UDT</span></code>-annotated
classes to their CQL counterpart) was removed, as well as the
corresponding method <code class="docutils literal notranslate"><span class="pre">MappingManager#udtMapper</span></code>.</p>
<p>The mapper now uses custom codecs to convert UDTs. See more
explanations <a class="reference external" href="../manual/object_mapper/custom_codecs/#implicit-udt-codecs">here</a>.</p>
</li>
<li><p>All methods that took the protocol version as an <code class="docutils literal notranslate"><span class="pre">int</span></code> or assumed a
default version have been removed (they were already deprecated in
2.1):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">AbstractGettableData(int)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Cluster.Builder#withProtocolVersion(int)</span></code></p></li>
<li><p>in <code class="docutils literal notranslate"><span class="pre">ProtocolOptions</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">NEWEST_SUPPORTED_PROTOCOL_VERSION</span></code> (replaced by
<code class="docutils literal notranslate"><span class="pre">ProtocolVersion#NEWEST_SUPPORTED</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">getProtocolVersion()</span></code></p></li>
</ul>
</li>
</ul>
<p>There are now variants of these methods using the <code class="docutils literal notranslate"><span class="pre">ProtocolVersion</span></code>
enum. In addition, <code class="docutils literal notranslate"><span class="pre">ProtocolOptions#getProtocolVersionEnum</span></code> has been
renamed to <code class="docutils literal notranslate"><span class="pre">ProtocolOptions#getProtocolVersion</span></code>.</p>
</li>
<li><p>All methods related to the “suspected” host state have been removed
(they had been deprecated in 2.1.6 when the suspicion mechanism was
removed):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Host.StateListener#onSuspected()</span></code> (was inherited by
<code class="docutils literal notranslate"><span class="pre">LoadBalancingPolicy</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Host#getInitialReconnectionAttemptFuture()</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">PoolingOptions#setMinSimultaneousRequestsPerConnectionThreshold(HostDistance,</span> <span class="pre">int)</span></code> has been removed. The new connection pool resizing algorithm introduced by
<a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-419">JAVA-419</a> does not need this
threshold anymore.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AddressTranslater</span></code> has been renamed to <code class="docutils literal notranslate"><span class="pre">AddressTranslator</span></code>. All
related methods and classes have also been renamed.</p>
<p>In addition, the <code class="docutils literal notranslate"><span class="pre">close()</span></code> method has been pulled up into
<code class="docutils literal notranslate"><span class="pre">AddressTranslator</span></code>, and <code class="docutils literal notranslate"><span class="pre">CloseableAddressTranslator</span></code> has been removed.
Existing third-party <code class="docutils literal notranslate"><span class="pre">AddressTranslator</span></code> implementations only need
to add an empty <code class="docutils literal notranslate"><span class="pre">close()</span></code> method.</p>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">close()</span></code> method has been pulled up into <code class="docutils literal notranslate"><span class="pre">LoadBalancingPolicy</span></code>,
and <code class="docutils literal notranslate"><span class="pre">CloseableLoadBalancingPolicy</span></code> has been removed. Existing third-party
<code class="docutils literal notranslate"><span class="pre">LoadBalancingPolicy</span></code> implementations only need to add an empty
<code class="docutils literal notranslate"><span class="pre">close()</span></code> method.</p></li>
<li><p>All pluggable components now have callbacks to detect when they get
associated with a <code class="docutils literal notranslate"><span class="pre">Cluster</span></code> instance:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ReconnectionPolicy</span></code>, <code class="docutils literal notranslate"><span class="pre">RetryPolicy</span></code>, <code class="docutils literal notranslate"><span class="pre">AddressTranslator</span></code>,
and <code class="docutils literal notranslate"><span class="pre">TimestampGenerator</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">init(Cluster)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">close()</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Host.StateListener</span></code> and <code class="docutils literal notranslate"><span class="pre">LatencyTracker</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">onRegister(Cluster)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">onUnregister(Cluster)</span></code></p></li>
</ul>
</li>
</ul>
<p>This gives these components the opportunity to perform
initialization / cleanup tasks. Existing third-party implementations
only need to add empty methods.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">LoadBalancingPolicy</span></code> does not extend <code class="docutils literal notranslate"><span class="pre">Host.StateListener</span></code> anymore:
callback methods (<code class="docutils literal notranslate"><span class="pre">onUp</span></code>, <code class="docutils literal notranslate"><span class="pre">onDown</span></code>, etc.) have been duplicated. This
is unlikely to affect clients.</p></li>
<li><p><a class="reference external" href="../manual/query_timestamps/">Client-side timestamp generation</a> is
now the default (provided that <a class="reference external" href="../manual/native_protocol">native
protocol</a> v3 or higher is in use). The
generator used is <code class="docutils literal notranslate"><span class="pre">AtomicMonotonicTimestampGenerator</span></code>.</p></li>
<li><p>If a DNS name resolves to multiple A-records,
<code class="docutils literal notranslate"><span class="pre">Cluster.Builder#addContactPoint(String)</span></code> will now use all of these
addresses as contact points. This gives you the possibility of
maintaining contact points in DNS configuration, and having a single,
static contact point in your Java code.</p></li>
<li><p>The following methods were added for <a class="reference external" href="../manual/custom_payloads">Custom payloads</a>:</p>
<ul class="simple">
<li><p>in <code class="docutils literal notranslate"><span class="pre">PreparedStatement</span></code>: <code class="docutils literal notranslate"><span class="pre">getIncomingPayload()</span></code>,
<code class="docutils literal notranslate"><span class="pre">getOutgoingPayload()</span></code> and
<code class="docutils literal notranslate"><span class="pre">setOutgoingPayload(Map&lt;String,ByteBuffer&gt;)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AbstractSession#prepareAsync(String,</span> <span class="pre">Map&lt;String,ByteBuffer&gt;)</span></code></p></li>
</ul>
<p>Also, note that <code class="docutils literal notranslate"><span class="pre">AbstractSession#prepareAsync(Statement)</span></code> does not
call <code class="docutils literal notranslate"><span class="pre">AbstractSession#prepareAsync(String)</span></code> anymore, they now both
delegate to a protected method.</p>
<p>This breaks binary compatibility for these two classes; if you have
custom implementations, you will have to adapt them accordingly.</p>
</li>
<li><p>Getters and setters have been added to “data-container” classes for
new CQL types:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">getByte</span></code>/<code class="docutils literal notranslate"><span class="pre">setByte</span></code> for the <code class="docutils literal notranslate"><span class="pre">TINYINT</span></code> type</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getShort</span></code>/<code class="docutils literal notranslate"><span class="pre">setShort</span></code> for the <code class="docutils literal notranslate"><span class="pre">SMALLINT</span></code> type</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getTime</span></code>/<code class="docutils literal notranslate"><span class="pre">setTime</span></code> for the <code class="docutils literal notranslate"><span class="pre">TIME</span></code> type</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getDate</span></code>/<code class="docutils literal notranslate"><span class="pre">setDate</span></code> for the <code class="docutils literal notranslate"><span class="pre">DATE</span></code> type</p></li>
</ul>
<p>The methods for the <code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span></code> CQL type have been renamed to
<code class="docutils literal notranslate"><span class="pre">getTimestamp</span></code> and <code class="docutils literal notranslate"><span class="pre">setTimestamp</span></code>.</p>
<p>This affects <code class="docutils literal notranslate"><span class="pre">Row</span></code>, <code class="docutils literal notranslate"><span class="pre">BoundStatement</span></code>, <code class="docutils literal notranslate"><span class="pre">TupleValue</span></code> and <code class="docutils literal notranslate"><span class="pre">UDTValue</span></code>.</p>
</li>
<li><p>New exception types have been added to handle additional server-side
errors introduced in Cassandra 2.2:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ReadFailureException</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WriteFailureException</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FunctionExecutionException</span></code></p></li>
</ul>
<p>This is not a breaking change since all driver exceptions are
unchecked; but clients might decide to handle these errors in a specific
way.</p>
<p>In addition, <code class="docutils literal notranslate"><span class="pre">QueryTimeoutException</span></code> has been renamed to
<code class="docutils literal notranslate"><span class="pre">QueryExecutionException</span></code> (this is an intermediary class in our
exception hierarchy, it now has new child classes that are not
related to timeouts).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ResultSet#fetchMoreResults()</span></code> now returns a <code class="docutils literal notranslate"><span class="pre">ListenableFuture&lt;ResultSet&gt;</span></code>.
This makes the API more friendly if you chain transformations on an async
query to process all pages (see <code class="docutils literal notranslate"><span class="pre">AsyncResultSetTest</span></code> in the sources for an
example).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Frozen</span></code> annotations in the mapper are no longer checked at runtime (see
<a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-843">JAVA-843</a> for more
explanations). So they become purely informational at this stage.
However it is a good idea to keep using these annotations and make sure
they match the schema, in anticipation for the schema generation features
that will be added in a future version.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AsyncInitSession</span></code> has been removed, <code class="docutils literal notranslate"><span class="pre">initAsync()</span></code> is now part of the
<code class="docutils literal notranslate"><span class="pre">Session</span></code> interface (the only purpose of the extra interface was to preserve
binary compatibility on the 2.1 branch).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TableMetadata.Options</span></code> has been made a top-level class and renamed to
<code class="docutils literal notranslate"><span class="pre">TableOptionsMetadata</span></code>. It is now also used by <code class="docutils literal notranslate"><span class="pre">MaterializedViewMetadata</span></code>.</p></li>
<li><p>The mapper annotation <code class="docutils literal notranslate"><span class="pre">&#64;Enumerated</span></code> has been removed, users should now
use the newly-introduced <code class="docutils literal notranslate"><span class="pre">driver-extras</span></code> module to get automatic
enum-to-CQL mappings. Two new codecs provide the same functionality:
<code class="docutils literal notranslate"><span class="pre">EnumOrdinalCodec</span></code> and <code class="docutils literal notranslate"><span class="pre">EnumNameCodec</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">enum</span> <span class="n">Foo</span> <span class="o">{...}</span>
<span class="kd">enum</span> <span class="n">Bar</span> <span class="o">{...}</span>

<span class="c1">// register the appropriate codecs</span>
<span class="n">CodecRegistry</span><span class="o">.</span><span class="na">DEFAULT_INSTANCE</span>
    <span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">EnumOrdinalCodec</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;(</span><span class="n">Foo</span><span class="o">.</span><span class="na">class</span><span class="o">))</span>
    <span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">EnumNameCodec</span><span class="o">&lt;</span><span class="n">Bar</span><span class="o">&gt;(</span><span class="n">Bar</span><span class="o">.</span><span class="na">class</span><span class="o">))</span>

<span class="c1">// the following mappings are handled out-of-the-box</span>
<span class="nd">@Table</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyPojo</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Foo</span> <span class="n">foo</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Bar</span><span class="o">&gt;</span> <span class="n">bars</span><span class="o">;</span>
    <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
</li>
<li><p>The interface <code class="docutils literal notranslate"><span class="pre">IdempotenceAwarePreparedStatement</span></code> has been removed
and now the <code class="docutils literal notranslate"><span class="pre">PreparedStatement</span></code> interface exposes 2 new methods,
<code class="docutils literal notranslate"><span class="pre">setIdempotent(Boolean)</span></code> and <code class="docutils literal notranslate"><span class="pre">isIdempotent()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RetryPolicy</span></code> and <code class="docutils literal notranslate"><span class="pre">ExtendedRetryPolicy</span></code> (introduced in 2.1.10)
were merged together; as a consequence, <code class="docutils literal notranslate"><span class="pre">RetryPolicy</span></code> now has one
more method: <code class="docutils literal notranslate"><span class="pre">onRequestError</span></code>; see
<a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-819">JAVA-819</a> for
more information. Furthermore, <code class="docutils literal notranslate"><span class="pre">FallthroughRetryPolicy</span></code> now returns
<code class="docutils literal notranslate"><span class="pre">RetryDecision.rethrow()</span></code> when <code class="docutils literal notranslate"><span class="pre">onRequestError</span></code> is called.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DseAuthProvider</span></code> has been deprecated and is now replaced by
<code class="docutils literal notranslate"><span class="pre">DseGSSAPIAuthProvider</span></code> for Kerberos authentication. <code class="docutils literal notranslate"><span class="pre">DsePlainTextAuthProvider</span></code>
has been introduced to handle plain text authentication with the
<code class="docutils literal notranslate"><span class="pre">DseAuthenticator</span></code>.</p></li>
<li><p>The constructor of <code class="docutils literal notranslate"><span class="pre">DCAwareRoundRobinPolicy</span></code> is not accessible anymore. You
should use <code class="docutils literal notranslate"><span class="pre">DCAwareRoundRobinPolicy#builder()</span></code> to create new instances.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ColumnMetadata.getTable()</span></code> has been renamed to <code class="docutils literal notranslate"><span class="pre">ColumnMetadata.getParent()</span></code>.
Also, its return type is now <code class="docutils literal notranslate"><span class="pre">AbstractTableMetadata</span></code> which can be either
a <code class="docutils literal notranslate"><span class="pre">TableMetadata</span></code> object or a <code class="docutils literal notranslate"><span class="pre">MaterializedViewMetadata</span></code> object.
This change is motivated by the fact that a column can now belong to a
table or a materialized view.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ColumnMetadata.getIndex()</span></code> has been removed.
This is due to the fact that secondary indexes have been completely redesigned
in Cassandra 3.0, and the former one-to-one relationship between a column and its index
has been replaced with a one-to-many relationship between a table and its indexes.
This is reflected in the driver’s API by the new methods
<code class="docutils literal notranslate"><span class="pre">TableMetadata.getIndexes()</span></code> and <code class="docutils literal notranslate"><span class="pre">TableMetadata.getIndex(String</span> <span class="pre">name)</span></code>.
See <a class="reference external" href="https://issues.apache.org/jira/browse/CASSANDRA-9459">CASSANDRA-9459</a> and
and <a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-1008">JAVA-1008</a> for
more details.
Unfortunately, there is no easy way to recover the functionality provided
by the deleted method, <em>even for Cassandra versions &lt;= 3.0</em>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IndexMetadata</span></code> is now a top-level class and its structure has been deeply modified.
Again, this is due to the fact that secondary indexes have been completely redesigned
in Cassandra 3.0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SSLOptions</span></code> has been refactored to allow the option to choose between JDK and Netty-based
SSL implementations.  See <a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-841">JAVA-841</a> and
the <a class="reference external" href="../manual/ssl">SSL documentation</a> for more details.</p></li>
</ol>
</div>
<div class="section" id="id9">
<h2>2.1.8<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p>2.1.8 is binary-compatible with 2.1.7 but introduces a small change in the
driver’s behavior:</p>
<ol class="simple">
<li><p>The list of contact points provided at startup is now shuffled before trying
to open the control connection, so that multiple clients with the same contact
points don’t all pick the same control host. As a result, you can’t assume that
the driver will try contact points in a deterministic order. In particular, if
you use the <code class="docutils literal notranslate"><span class="pre">DCAwareRoundRobinPolicy</span></code> without specifying a primary datacenter
name, make sure that you only provide local hosts as contact points.</p></li>
</ol>
</div>
<div class="section" id="id10">
<h2>2.1.7<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p>This version brings a few changes in the driver’s behavior; none of them break
binary compatibility.</p>
<ol>
<li><p>The <code class="docutils literal notranslate"><span class="pre">DefaultRetryPolicy</span></code>’s behaviour has changed in the case of an Unavailable
exception received from a request. The new behaviour will cause the driver to
process a Retry on a different node at most once, otherwise an exception will
be thrown. This change makes sense in the case where the node tried initially
for the request happens to be isolated from the rest of the cluster (e.g.
because of a network partition) but can still answer to the client normally.
In this case, trying another node has a chance of success.
The previous behaviour was to always throw an exception.</p></li>
<li><p>The following properties in <code class="docutils literal notranslate"><span class="pre">PoolingOptions</span></code> were renamed:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MaxSimultaneousRequestsPerConnectionThreshold</span></code> to <code class="docutils literal notranslate"><span class="pre">NewConnectionThreshold</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MaxSimultaneousRequestsPerHostThreshold</span></code> to <code class="docutils literal notranslate"><span class="pre">MaxRequestsPerConnection</span></code></p></li>
</ul>
<p>The old getters/setters were deprecated, but they delegate to the new
ones.</p>
<p>Also, note that the connection pool for protocol v3 can now be configured to
use multiple connections. See <a class="reference external" href="../manual/pooling">this page</a> for more
information.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MappingManager(Session)</span></code> will now force the initialization of the <code class="docutils literal notranslate"><span class="pre">Session</span></code>
if needed. This is a change from 2.1.6, where if you gave it an uninitialized
session (created with <code class="docutils literal notranslate"><span class="pre">Cluster#newSession()</span></code> instead of <code class="docutils literal notranslate"><span class="pre">Cluster#connect()</span></code>),
it would only get initialized on the first request.</p>
<p>If this is a problem for you, <code class="docutils literal notranslate"><span class="pre">MappingManager(Session,</span> <span class="pre">ProtocolVersion)</span></code>
preserves the previous behavior (see the API docs for more details).</p>
</li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">BuiltStatement</span></code> is now considered non-idempotent whenever a <code class="docutils literal notranslate"><span class="pre">fcall()</span></code>
or <code class="docutils literal notranslate"><span class="pre">raw()</span></code> is used to build a value to be inserted in the database.
If you know that the CQL functions or expressions are safe, use
<code class="docutils literal notranslate"><span class="pre">setIdempotent(true)</span></code> on the statement.</p></li>
</ol>
</div>
<div class="section" id="id11">
<h2>2.1.6<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference external" href="#2-0-x-to-2-0-10">2.0.10</a>.</p>
</div>
<div class="section" id="id12">
<h2>2.1.2<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>2.1.2 brings important internal changes with native protocol v3 support, but
the impact on the public API has been kept as low as possible.</p>
<div class="section" id="user-api-changes">
<h3>User API Changes<a class="headerlink" href="#user-api-changes" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>The native protocol version is now modelled as an enum: <code class="docutils literal notranslate"><span class="pre">ProtocolVersion</span></code>.
Most public methods that take it as an argument have a backward-compatible
version that takes an <code class="docutils literal notranslate"><span class="pre">int</span></code> (the exception being <code class="docutils literal notranslate"><span class="pre">RegularStatement</span></code>,
described below). For new code, prefer the enum version.</p></li>
</ol>
</div>
<div class="section" id="internal-api-changes">
<h3>2.1.6 Internal API Changes<a class="headerlink" href="#internal-api-changes" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RegularStatement.getValues</span></code> now takes the protocol version as a
<code class="docutils literal notranslate"><span class="pre">ProtocolVersion</span></code> instead of an <code class="docutils literal notranslate"><span class="pre">int</span></code>. This is transparent for callers
since there is a backward-compatible alternative, but if you happened to
extend the class you’ll need to update your implementation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BatchStatement.setSerialConsistencyLevel</span></code> now returns <code class="docutils literal notranslate"><span class="pre">BatchStatement</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">Statement</span></code>. Again, this only matters if you extended this
class (if so, it might be a good idea to also have a covariant return in
your child class).</p></li>
<li><p>The constructor of <code class="docutils literal notranslate"><span class="pre">UnsupportedFeatureException</span></code> now takes a
<code class="docutils literal notranslate"><span class="pre">ProtocolVersion</span></code> as a parameter. This should impact few users, as there’s
hardly any reason to build instances of that class from client code.</p></li>
</ol>
</div>
<div class="section" id="new-features">
<h3>New features<a class="headerlink" href="#new-features" title="Permalink to this headline">¶</a></h3>
<p>These features are only active when the native protocol v3 is in use.</p>
<ol class="simple">
<li><p>The driver now uses a single connection per host (as opposed to a pool in
2.1.1). Most options in <code class="docutils literal notranslate"><span class="pre">PoolingOptions</span></code> are ignored, except for a new one
called <code class="docutils literal notranslate"><span class="pre">maxSimultaneousRequestsPerHostThreshold</span></code>. See the class’s Javadocs
for detailed explanations.</p></li>
<li><p>You can now provide a default timestamp with each query (but it will be
ignored if the CQL query string already contains a <code class="docutils literal notranslate"><span class="pre">USING</span> <span class="pre">TIMESTAMP</span></code>
clause). This can be done on a per-statement basis with
<code class="docutils literal notranslate"><span class="pre">Statement.setDefaultTimestamp</span></code>, or automatically with a
<code class="docutils literal notranslate"><span class="pre">TimestampGenerator</span></code> specified with
<code class="docutils literal notranslate"><span class="pre">Cluster.Builder.withTimestampGenerator</span></code> (two implementations are
provided: <code class="docutils literal notranslate"><span class="pre">ThreadLocalMonotonicTimestampGenerator</span></code> and
<code class="docutils literal notranslate"><span class="pre">AtomicMonotonicTimestampGenerator</span></code>). If you specify both, the statement’s
timestamp takes precedence over the generator. By default, the driver has
the same behavior as 2.1.1 (no generator, timestamps are assigned by
Cassandra unless <code class="docutils literal notranslate"><span class="pre">USING</span> <span class="pre">TIMESTAMP</span></code> was specified).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BatchStatement.setSerialConsistencyLevel</span></code> no longer throws an exception,
it will honor the serial consistency level for the batch.</p></li>
</ol>
</div>
</div>
<div class="section" id="id13">
<h2>2.1.1<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id14">
<h3>2.1.1 Internal API Changes<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">ResultSet</span></code> interface has a new <code class="docutils literal notranslate"><span class="pre">wasApplied()</span></code> method. This will
only affect clients that provide their own implementation of this interface.</p></li>
</ol>
</div>
</div>
<div class="section" id="id15">
<h2>2.1.0<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id16">
<h3>2.1.0 User API Changes<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">getCaching</span></code> method of <code class="docutils literal notranslate"><span class="pre">TableMetadata#Options</span></code> now returns a
<code class="docutils literal notranslate"><span class="pre">Map</span></code> to account for changes to Cassandra 2.1. Also, the
<code class="docutils literal notranslate"><span class="pre">getIndexInterval</span></code> method now returns an <code class="docutils literal notranslate"><span class="pre">Integer</span></code> instead of an <code class="docutils literal notranslate"><span class="pre">int</span></code>
which will be <code class="docutils literal notranslate"><span class="pre">null</span></code> when connected to Cassandra 2.1 nodes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BoundStatement</span></code> variables that have not been set explicitly will no
longer default to <code class="docutils literal notranslate"><span class="pre">null</span></code>. Instead, all variables must be bound explicitly,
otherwise the execution of the statement will fail (this also applies to
statements inside of a <code class="docutils literal notranslate"><span class="pre">BatchStatement</span></code>). For variables that map to a
primitive Java type, a new <code class="docutils literal notranslate"><span class="pre">setToNull</span></code> method has been added.
We made this change because the driver might soon distinguish between unset
and null variables, so we don’t want clients relying on the “leave unset to
set to <code class="docutils literal notranslate"><span class="pre">null</span></code>” behavior.</p></li>
</ol>
</div>
<div class="section" id="id17">
<h3>2.1.0 Internal API Changes<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>The changes listed in this section should normally not impact end users of the
driver, but rather third-party frameworks and tools.</p>
<ol class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">serialize</span></code> and <code class="docutils literal notranslate"><span class="pre">deserialize</span></code> methods in <code class="docutils literal notranslate"><span class="pre">DataType</span></code> now take an
additional parameter: the protocol version. As explained in the javadoc,
if unsure, the proper value to use for this parameter is the protocol version
in use by the driver, i.e. the value returned by
<code class="docutils literal notranslate"><span class="pre">cluster.getConfiguration().getProtocolOptions().getProtocolVersion()</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">parse</span></code> method in <code class="docutils literal notranslate"><span class="pre">DataType</span></code> now returns a Java object, not a
<code class="docutils literal notranslate"><span class="pre">ByteBuffer</span></code>. The previous behavior can be obtained by calling the
<code class="docutils literal notranslate"><span class="pre">serialize</span></code> method on the returned object.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">getValues</span></code> method of <code class="docutils literal notranslate"><span class="pre">RegularStatement</span></code> now takes the protocol
version as a parameter. As above, the proper value if unsure is almost surely
the protocol version in use
(<code class="docutils literal notranslate"><span class="pre">cluster.getConfiguration().getProtocolOptions().getProtocolVersion()</span></code>).</p></li>
</ol>
</div>
</div>
<div class="section" id="id18">
<h2>2.0.11<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<p>2.0.11 preserves binary compatibility with previous versions. There are a few
changes in the driver’s behavior:</p>
<ol class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">DefaultRetryPolicy</span></code>’s behaviour has changed in the case of an Unavailable
exception received from a request. The new behaviour will cause the driver to
process a Retry on a different node at most once, otherwise an exception will
be thrown. This change makes sense in the case where the node tried initially
for the request happens to be isolated from the rest of the cluster (e.g.
because of a network partition) but can still answer to the client normally.
In this case, trying another node has a chance of success.
The previous behaviour was to always throw an exception.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">BuiltStatement</span></code> is now considered non-idempotent whenever a <code class="docutils literal notranslate"><span class="pre">fcall()</span></code>
or <code class="docutils literal notranslate"><span class="pre">raw()</span></code> is used to build a value to be inserted in the database.
If you know that the CQL functions or expressions are safe, use
<code class="docutils literal notranslate"><span class="pre">setIdempotent(true)</span></code> on the statement.</p></li>
<li><p>The list of contact points provided at startup is now shuffled before trying
to open the control connection, so that multiple clients with the same contact
points don’t all pick the same control host. As a result, you can’t assume that
the driver will try contact points in a deterministic order. In particular, if
you use the <code class="docutils literal notranslate"><span class="pre">DCAwareRoundRobinPolicy</span></code> without specifying a primary datacenter
name, make sure that you only provide local hosts as contact points.</p></li>
</ol>
</div>
<div class="section" id="a-name-2-0-x-to-2-0-10-a-2-0-x-to-2-0-10">
<h2><a name="2-0-x-to-2-0-10"></a>2.0.x to 2.0.10<a class="headerlink" href="#a-name-2-0-x-to-2-0-10-a-2-0-x-to-2-0-10" title="Permalink to this headline">¶</a></h2>
<p>We try to avoid breaking changes within a branch (2.0.x to 2.0.y), but
2.0.10 saw a lot of new features and internal improvements. There is one
breaking change:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LatencyTracker#update</span></code> now has a different signature and takes two new
parameters: the statement that has been executed (never null), and the exception
thrown while executing the query (or null, if the query executed successfully).
Existing implementations of this interface, once upgraded to the new method
signature, should continue to work as before.</p></li>
</ol>
<p>The following might also be of interest:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SocketOptions#getTcpNoDelay()</span></code> is now TRUE by default (it was previously undefined).
This reflects the new behavior of Netty (which was upgraded from version 3.9.0 to
4.0.27): <code class="docutils literal notranslate"><span class="pre">TCP_NODELAY</span></code> is now turned on by default, instead of depending on the OS
default like in previous versions.</p></li>
<li><p>Netty is not shaded anymore in the default Maven artifact. However we publish a
<a class="reference external" href="../manual/shaded_jar/">shaded artifact</a> under a different classifier.</p></li>
<li><p>The internal initialization sequence of the Cluster object has been slightly changed:
some fields that were previously initialized in the constructor are now set when
the <code class="docutils literal notranslate"><span class="pre">init()</span></code> method is called. In particular, <code class="docutils literal notranslate"><span class="pre">Cluster#getMetrics()</span></code> will return
<code class="docutils literal notranslate"><span class="pre">null</span></code> until the cluster is initialized.</p></li>
</ol>
</div>
<div class="section" id="to-2-0">
<h2>1.0 to 2.0<a class="headerlink" href="#to-2-0" title="Permalink to this headline">¶</a></h2>
<p>We used the opportunity of a major version bump to incorporate your feedback
and improve the API, to fix a number of inconsistencies and remove cruft.
Unfortunately this means there are some breaking changes, but the new API should
be both simpler and more complete.</p>
<p>The following describes the changes for 2.0 that are breaking changes of the
1.0 API. For ease of use, we distinguish two categories of API changes: the “main”
ones and the “other” ones.</p>
<p>The “main” API changes are the ones that are either
likely to affect most upgraded apps or are incompatible changes that, even if minor,
will not be detected at compile time. Upgraders are highly encouraged to check
this list of “main” changes while upgrading their application to 2.0 (even
though most applications are likely to be affected by only a handful of
changes).</p>
<p>The “other” list is, well, other changes: those that are likely to
affect a minor number of applications and will be detected by compile time
errors anyway. It is ok to skip those initially and only come back to them if
you have trouble compiling your application after an upgrade.</p>
<div class="section" id="main-api-changes">
<h3>Main API changes<a class="headerlink" href="#main-api-changes" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">Query</span></code> class has been renamed into <code class="docutils literal notranslate"><span class="pre">Statement</span></code> (it was confusing
to some that the <code class="docutils literal notranslate"><span class="pre">BoundStatement</span></code> was not a <code class="docutils literal notranslate"><span class="pre">Statement</span></code>). To allow
this, the old <code class="docutils literal notranslate"><span class="pre">Statement</span></code> class has been renamed to <code class="docutils literal notranslate"><span class="pre">RegularStatement</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Cluster</span></code> and <code class="docutils literal notranslate"><span class="pre">Session</span></code> shutdown API has changed. There is now a
<code class="docutils literal notranslate"><span class="pre">closeAsync</span></code> that is asynchronous but returns a <code class="docutils literal notranslate"><span class="pre">Future</span></code> on the
completion of the shutdown process.  There is also a <code class="docutils literal notranslate"><span class="pre">close</span></code> shortcut
that does the same but blocks.  Also, <code class="docutils literal notranslate"><span class="pre">close</span></code> now waits for ongoing
queries to complete by default (but you can force the closing of all
connections if you want to).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NoHostAvailableException#getErrors</span></code> now returns the full exception objects for
each node instead of just a message. In other words, it returns a
<code class="docutils literal notranslate"><span class="pre">Map&lt;InetAddress,</span> <span class="pre">Throwable&gt;</span></code> instead of a <code class="docutils literal notranslate"><span class="pre">Map&lt;InetAddress,</span> <span class="pre">String&gt;</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Statement#getConsistencyLevel</span></code> (previously <code class="docutils literal notranslate"><span class="pre">Query#getConsistencyLevel</span></code>, see
first point) will now return <code class="docutils literal notranslate"><span class="pre">null</span></code> by default (instead of <code class="docutils literal notranslate"><span class="pre">CL.ONE</span></code>), with the
meaning of “use the default consistency level”.
The default consistency level can now be configured through the new <code class="docutils literal notranslate"><span class="pre">QueryOptions</span></code>
object in the cluster <code class="docutils literal notranslate"><span class="pre">Configuration</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Metrics</span></code> class now uses the Codahale metrics library version 3 (version 2 was
used previously). This new major version of the library has many API changes
compared to its version 2 (see the <a class="reference external" href="https://dropwizard.github.io/metrics/3.1.0/about/release-notes/">release notes</a> for details),
which can thus impact consumers of the Metrics class.
Furthermore, the default <code class="docutils literal notranslate"><span class="pre">JmxReporter</span></code> now includes a name specific to the
cluster instance (to avoid conflicts when multiple Cluster instances are created
in the same JVM). As a result, tools that were polling JMX info will
have to be updated accordingly.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QueryBuilder#in</span></code> method now has the following special case: using
<code class="docutils literal notranslate"><span class="pre">QueryBuilder.in(QueryBuilder.bindMarker())</span></code> will generate the string <code class="docutils literal notranslate"><span class="pre">IN</span> <span class="pre">?</span></code>,
not <code class="docutils literal notranslate"><span class="pre">IN</span> <span class="pre">(?)</span></code> as was the case in 1.0. The reasoning being that the former
syntax, made valid by <a class="reference external" href="https://issues.apache.org/jira/browse/CASSANDRA-4210">CASSANDRA-4210</a>
is a lot more useful than <code class="docutils literal notranslate"><span class="pre">IN</span> <span class="pre">(?)</span></code>, as the latter can more simply use an
equality.
Note that if you really want to output <code class="docutils literal notranslate"><span class="pre">IN</span> <span class="pre">(?)</span></code> with the query
builder, you can use <code class="docutils literal notranslate"><span class="pre">QueryBuilder.in(QueryBuilder.raw(&quot;?&quot;))</span></code>.</p></li>
<li><p>When binding values by name in <code class="docutils literal notranslate"><span class="pre">BoundStatement</span></code> (i.e. using the
<code class="docutils literal notranslate"><span class="pre">setX(String,</span> <span class="pre">X)</span></code> methods), if more than one variable have the same name,
then all values corresponding to that variable
name are set instead of just the first occurrence.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QueryBuilder#raw</span></code> method does not automatically add quotes anymore, but
rather output its result without any change (as the raw name implies).
This means for instance that <code class="docutils literal notranslate"><span class="pre">eq(&quot;x&quot;,</span> <span class="pre">raw(foo))</span></code> will output <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">foo</span></code>,
not <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">'foo'</span></code> (you don’t need the raw method to output the latter string).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QueryBuilder</span></code> will now sometimes use the new ability to send value as
bytes instead of serializing everything to string. In general the QueryBuilder
will do the right thing, but if you were calling the <code class="docutils literal notranslate"><span class="pre">getQueryString()</span></code> method
on a Statement created with a QueryBuilder (for other reasons than to prepare a query)
then the returned string may contain bind markers in place of some of the values
provided (and in that case, <code class="docutils literal notranslate"><span class="pre">getValues()</span></code> will contain the values corresponding
to those markers). If need be, it is possible to force the old behavior by
using the new <code class="docutils literal notranslate"><span class="pre">setForceNoValues()</span></code> method.</p></li>
</ol>
</div>
<div class="section" id="other-api-changes">
<h3>Other API Changes<a class="headerlink" href="#other-api-changes" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Creating a Cluster instance (through <code class="docutils literal notranslate"><span class="pre">Cluster#buildFrom</span></code> or the
<code class="docutils literal notranslate"><span class="pre">Cluster.Builder#build</span></code> method) <strong>does not create any connection right away
anymore</strong> (and thus cannot throw a <code class="docutils literal notranslate"><span class="pre">NoHostAvailableException</span></code> or an
<code class="docutils literal notranslate"><span class="pre">AuthenticationException</span></code>). Instead, the initial contact points are checked
the first time a call to <code class="docutils literal notranslate"><span class="pre">Cluster#connect</span></code> is done. If for some reason you
want to emulate the previous behavior, you can use the new method
<code class="docutils literal notranslate"><span class="pre">Cluster#init</span></code>: <code class="docutils literal notranslate"><span class="pre">Cluster.builder().build()</span></code> in 1.0 is equivalent to
<code class="docutils literal notranslate"><span class="pre">Cluster.builder().build().init()</span></code> in 2.0.</p></li>
<li><p>Methods from <code class="docutils literal notranslate"><span class="pre">Metadata</span></code>, <code class="docutils literal notranslate"><span class="pre">KeyspaceMetadata</span></code> and <code class="docutils literal notranslate"><span class="pre">TableMetadata</span></code> now use by default
case insensitive identifiers (for keyspace, table and column names in
parameter). You can double-quote an identifier if you want it to be a
case sensitive one (as you would do in CQL) and there is a <code class="docutils literal notranslate"><span class="pre">Metadata.quote</span></code>
helper method for that.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">TableMetadata#getClusteringKey</span></code> method has been renamed
<code class="docutils literal notranslate"><span class="pre">TableMetadata#getClusteringColumns</span></code> to match the “official” vocabulary.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">UnavailableException#getConsistency</span></code> method has been renamed to
<code class="docutils literal notranslate"><span class="pre">UnavailableException#getConsistencyLevel</span></code> for consistency with the method of
<code class="docutils literal notranslate"><span class="pre">QueryTimeoutException</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">RegularStatement</span></code> class (ex-<code class="docutils literal notranslate"><span class="pre">Statement</span></code> class, see above) must now
implement two additional methods: <code class="docutils literal notranslate"><span class="pre">RegularStatement#getKeyspace</span></code> and
<code class="docutils literal notranslate"><span class="pre">RegularStatement#getValues</span></code>. If you had extended this class, you will have to
implement those new methods, but both can return null if they are not useful
in your case.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Cluster.Initializer</span></code> interface should now implement 2 new methods:
<code class="docutils literal notranslate"><span class="pre">Cluster.Initializer#getInitialListeners</span></code> (which can return an empty
collection) and <code class="docutils literal notranslate"><span class="pre">Cluster.Initializer#getClusterName</span></code> (which can return null).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Metadata#getReplicas</span></code> method now takes 2 arguments. On top of the
partition key, you must now provide the keyspace too. The previous behavior
was buggy: it’s impossible to properly return the full list of replica for a
partition key without knowing the keyspace since replication may depend on
the keyspace).</p></li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">LoadBalancingPolicy#newQueryPlan()</span></code> method now takes the currently
logged keyspace as 2nd argument. This information is necessary to do proper
token aware balancing (see preceding point).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">ResultSetFuture#set</span></code> and <code class="docutils literal notranslate"><span class="pre">ResultSetFuture#setException</span></code> methods have been
removed (from the public API at least). They were never meant to be exposed
publicly: a <code class="docutils literal notranslate"><span class="pre">resultSetFuture</span></code> is always set by the driver itself and should
not be set manually.</p></li>
<li><p>The deprecated since 1.0.2 <code class="docutils literal notranslate"><span class="pre">Host.HealthMonitor</span></code> class has been removed. You
will now need to use <code class="docutils literal notranslate"><span class="pre">Host#isUp</span></code> and <code class="docutils literal notranslate"><span class="pre">Cluster#register</span></code> if you were using that
class.</p></li>
</ol>
</div>
<div class="section" id="features-available-only-with-cassandra-2-0">
<h3>Features available only with Cassandra 2.0<a class="headerlink" href="#features-available-only-with-cassandra-2-0" title="Permalink to this headline">¶</a></h3>
<p>This section details the biggest additions to 2.0 API wise. It is not an
exhaustive list of new features in 2.0.</p>
<ol>
<li><p>The new <code class="docutils literal notranslate"><span class="pre">BatchStatement</span></code> class allows to group any type of insert Statements
(<code class="docutils literal notranslate"><span class="pre">BoundStatement</span></code> or <code class="docutils literal notranslate"><span class="pre">RegularStatement</span></code>) for execution as a batch. For instance,
you can do something like:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">values</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">PreparedStatement</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="s">&quot;INSERT INTO myTable(value) VALUES (?)&quot;</span><span class="o">);</span>
<span class="n">BatchStatement</span> <span class="n">bs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BatchStatement</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">value</span> <span class="o">:</span> <span class="n">values</span><span class="o">)</span>
   <span class="n">bs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">ps</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">bs</span><span class="o">);</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SimpleStatement</span></code> can now take a list of values in addition to the query. This
allows to do the equivalent of a prepare+execute but with only one round-trip
to the server and without keeping the prepared statement after the
execution.</p>
<p>This is typically useful if a given query should be executed only
once (i.e. you don’t want to prepare it) but you also don’t want to
serialize all values into strings. Shortcut <code class="docutils literal notranslate"><span class="pre">Session#execute()</span></code> and
<code class="docutils literal notranslate"><span class="pre">Session#executeAsync()</span></code> methods are also provided so you that you can do:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">imgName</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">ByteBuffer</span> <span class="n">imgBytes</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">&quot;INSERT INTO images(name, bytes) VALUES (?, ?)&quot;</span><span class="o">,</span> <span class="n">imgName</span><span class="o">,</span> <span class="n">imgBytes</span><span class="o">);</span>
</pre></div>
</div>
</li>
<li><p>SELECT queries are now “paged” under the hood. In other words, if a query
yields a very large result, only the beginning of the <code class="docutils literal notranslate"><span class="pre">ResultSet</span></code> will be fetched
initially, the rest being fetched “on-demand”. In practice, this means that:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="o">(</span><span class="n">Row</span> <span class="n">r</span> <span class="o">:</span> <span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">&quot;SELECT * FROM mytable&quot;</span><span class="o">))</span>
   <span class="o">...</span> <span class="n">process</span> <span class="n">r</span> <span class="o">...</span>
</pre></div>
</div>
<p>should not timeout or OOM the server anymore even if “mytable” contains a lot
of data. In general paging should be transparent for the application (as in
the example above), but the implementation provides a number of knobs to
fine tune the behavior of that paging:</p>
<ul class="simple">
<li><p>the size of each “page” can be set per-query (<code class="docutils literal notranslate"><span class="pre">Statement#setFetchSize()</span></code>)</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">ResultSet</span></code> object provides 2 methods to check the state of paging
(<code class="docutils literal notranslate"><span class="pre">ResultSet#getAvailableWithoutFetching</span></code> and <code class="docutils literal notranslate"><span class="pre">ResultSet#isFullyFetched</span></code>)
as well as a mean to force the pre-fetching of the next page (<code class="docutils literal notranslate"><span class="pre">ResultSet#fetchMoreResults</span></code>).</p></li>
</ul>
</li>
</ol>
<div class="toctree-wrapper compound">
</div>
</div>
</div>
</div>
  <div class="content-navigation">
  <div class="navigation navigation--prev">
    <a class="navigation__link" href="../manual/udts/index.html">
      <button class="navigation__button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
      </button>
      <div class="navigation__title">
        <span class="colored">PREVIOUS</span> <br />User-defined types
      </div>
    </a>
  </div>
  <div class="navigation navigation--next">
    <a class="navigation__link" href="migrating_from_astyanax/index.html">
      <div class="navigation__title">
        <span class="colored">NEXT</span> <br />Migrating from Astyanax
      </div>
      <button class="navigation__button">
        <i class="scylla-icon scylla-icon--chevron-right"></i>
      </button>
    </a>
  </div>
</div> 
      </div>
      <div
        class="sidebar-left  large-order-1"
      > <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
  <button class="collapsible-button">
    <i class="scylla-icon scylla-icon--chevron-left"></i>
  </button>
  <div class="side-nav-content">
    <div class="side-nav__search">
      <div class="search-box">
        <ci-search></ci-search>
      </div>
    </div>
    <div class="side-nav__versions">
       <ul
  class="dropdown menu scylla-dropdown scylla-dropdown--versions "
  data-dropdown-menu
>
  <li class="scylla-dropdown__item">
    <a class="scylla-dropdown__title" href="#">
       3.7.2.x 
      <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
    </a>
    <ul class="menu scylla-dropdown__content"> 
      <li>
        <a href="index.html"
          >3.7.2.x</a
        >
      </li>
       
      <li>
        <a href="../../stable/index.html"
          >3.10.2.x</a
        >
      </li>
       
    </ul>
  </li>
</ul> 
    </div>
    <div class="side-nav__content">
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Scylla Java Driver for Scylla and Apache Cassandra®</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../manual/index.html">Manual</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../manual/address_resolution/index.html">Address resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/async/index.html">Asynchronous programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/auth/index.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/compression/index.html">Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/control_connection/index.html">Control connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/custom_codecs/index.html">Custom Codecs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/custom_payloads/index.html">Custom Payloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/idempotence/index.html">Query idempotence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/load_balancing/index.html">Load balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/logging/index.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/metadata/index.html">Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/metrics/index.html">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/native_protocol/index.html">Native protocol</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manual/object_mapper/index.html">Object Mapper</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../manual/object_mapper/creating/index.html">Definition of mapped classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/object_mapper/custom_codecs/index.html">Using custom codecs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/object_mapper/using/index.html">Using the mapper</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../manual/osgi/index.html">OSGi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/paging/index.html">Paging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/pooling/index.html">Connection pooling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/query_timestamps/index.html">Query timestamps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/reconnection/index.html">Reconnection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/retries/index.html">Retries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/shaded_jar/index.html">Using the shaded JAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/socket_options/index.html">Socket options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/speculative_execution/index.html">Speculative query execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/ssl/index.html">SSL</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manual/statements/index.html">Statements</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../manual/statements/simple/index.html">Simple statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/statements/prepared/index.html">Prepared statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/statements/built/index.html">Built statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/statements/batch/index.html">Batch statements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../manual/tuples/index.html">Using Tuples with the Java driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/udts/index.html">User-defined types</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children current-page"><a class="current reference internal" href="#">Upgrade guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="migrating_from_astyanax/index.html">Migrating from Astyanax</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="migrating_from_astyanax/configuration/index.html">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="migrating_from_astyanax/language_level_changes/index.html">Language change : from Thrift to CQL</a></li>
<li class="toctree-l3"><a class="reference internal" href="migrating_from_astyanax/queries_and_results/index.html">Queries and Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
      
      <div class="sidebar-right large-order-3">
         <div class="secondary-side-nav custom-scroll-bar">
  <div class="secondary-side-nav__content">
    <p class="topic-title">On this page</p>
    <ul>
<li><a class="reference internal" href="#">Upgrade guide</a><ul>
<li><a class="reference internal" href="#id1">3.6.0</a></li>
<li><a class="reference internal" href="#id2">3.5.0</a></li>
<li><a class="reference internal" href="#id3">3.4.0</a></li>
<li><a class="reference internal" href="#id4">3.3.1</a></li>
<li><a class="reference internal" href="#id5">3.2.0</a></li>
<li><a class="reference internal" href="#id6">3.1.0</a></li>
<li><a class="reference internal" href="#id7">3.0.4</a></li>
<li><a class="reference internal" href="#id8">3.0.0</a></li>
<li><a class="reference internal" href="#id9">2.1.8</a></li>
<li><a class="reference internal" href="#id10">2.1.7</a></li>
<li><a class="reference internal" href="#id11">2.1.6</a></li>
<li><a class="reference internal" href="#id12">2.1.2</a><ul>
<li><a class="reference internal" href="#user-api-changes">User API Changes</a></li>
<li><a class="reference internal" href="#internal-api-changes">2.1.6 Internal API Changes</a></li>
<li><a class="reference internal" href="#new-features">New features</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id13">2.1.1</a><ul>
<li><a class="reference internal" href="#id14">2.1.1 Internal API Changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id15">2.1.0</a><ul>
<li><a class="reference internal" href="#id16">2.1.0 User API Changes</a></li>
<li><a class="reference internal" href="#id17">2.1.0 Internal API Changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id18">2.0.11</a></li>
<li><a class="reference internal" href="#a-name-2-0-x-to-2-0-10-a-2-0-x-to-2-0-10"><a name="2-0-x-to-2-0-10"></a>2.0.x to 2.0.10</a></li>
<li><a class="reference internal" href="#to-2-0">1.0 to 2.0</a><ul>
<li><a class="reference internal" href="#main-api-changes">Main API changes</a></li>
<li><a class="reference internal" href="#other-api-changes">Other API Changes</a></li>
<li><a class="reference internal" href="#features-available-only-with-cassandra-2-0">Features available only with Cassandra 2.0</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
</div> 
      </div>
    </section>

    <footer class="footer">
  <div class="footer-group">
    <div class="footer-top">
      <a class="footer-logo" href="https://www.scylladb.com"
        ><img
          src="../_static/img/logo-scylla-horizontal-RGB.svg"
          alt="Logo"
      /></a>
      <div class="footer-links">
        <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
        <a
          class="footer-links__link"
          href="https://www.scylladb.com/company/contact-us/"
          >Contact Us</a
        >
        <a class="footer-links__link" href="https://www.scylladb.com/company/"
          >About Us</a
        >
      </div>
      <div class="footer-actions">
        <a
          class="footer-actions__link"
          href="https://groups.google.com/g/scylladb-users"
          target="_blank"
          ><span
            data-tooltip
            tabindex="1"
            title="User mailing list"
            data-position="bottom"
          >
            <img
              src="../_static/img/icons/icon-mail-list.svg"
              alt="Mail List Icon"
            />
          </span>
        </a>
        <a
          class="footer-actions__link"
          href="http://slack.scylladb.com/"
          target="_blank"
          ><span
            data-tooltip
            tabindex="1"
            title="User Slack channel"
            data-position="bottom"
          >
            <img
              src="../_static/img/icons/icon-slack.svg"
              alt="Slack Icon"
          /></span>
        </a>
      </div>
    </div>

    <div class="footer-bottom">
      <div class="footer-bottom__copyright"> &#169; 2022, ScyllaDB. All rights reserved.
      </div>
      <div class="footer-bottom__last-updated">
        Last updated on 07 February 2022.
      </div>
      <div class="footer-bottom__version">
        Powered by
        <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a> &amp;
        <a href="https://sphinx-theme.scylladb.com/"
          >ScyllaDB Theme 1.0.6</a
        >
      </div>
    </div>
  </div>
</footer>

    <noscript>
      <iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe>
    </noscript>
  </body>
</html>